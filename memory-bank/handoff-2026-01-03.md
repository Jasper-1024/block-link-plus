# Handoff (2026-01-03)

## 当前状态
- 本地分支：`fix/issues-22-27-28-29`
- 远程：`origin` -> `git@github.com:Jasper-1024/block-link-plus.git`

## 已完成
- Issues #22/#27/#28：多行/列表 block id 生成逻辑修复 + 回归测试 + OpenSpec change（`openspec/changes/update-multiline-block-handling/`）
- Issue #29：修复 Reading-mode postprocessor 误删文本导致“滚动变空白”的高风险逻辑（`src/ui/MarkdownPost.ts`），并补测试
- Jest 警告清理：移除重复 manual mock（`obsidian-dataview`）与 `ts-jest` deprecated 配置

## 关键行为变更（简述）
- #22：Multi-block 模式按“Markdown block”（段落/列表项等）生成/复用 `^id`，partial overlap 也算选中
- #27：列表场景以“光标所在 list item”作为目标，不复用同一 list section 的首项/上一项 `^id`
- #28：`^id-id` end marker 永远是独立行；若下一行有内容则在 marker 后补一个空行（若下一行已空则不额外插入）
- #29：不再在 postprocessor 中对所有文本节点做全局 replace（避免整篇笔记内容被清空）

## 验证
- `openspec validate update-multiline-block-handling --strict` ✅
- `npm test` ✅（6 suites / 46 tests）

## 主要提交
- `3bbe0da` Fix multiline block handling (issues #22/#27/#28)
- `c3162a5` Fix reading-mode postprocessor blanking notes (#29)
- `2177450` Fix range end marker block separation

## 待继续（下一站）
- 进一步确认 `^id-id` 在 Obsidian（尤其 Android）解析/“隐藏”相关的格式要求：是否需要 marker 与上方内容之间也强制空行；以及是否应继续做“隐藏”还是接受可见 marker 来减少对原文结构的侵入
- Android 端手动复测 #29：打开含 `![[note#^id-id]]` 的笔记，返回/滚动，确认不再空白

