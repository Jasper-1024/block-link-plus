.cm-line.blp-enhanced-list-system-line-hidden {
    display: none !important;
}

.markdown-source-view.mod-cm6 .cm-lineNumbers .cm-gutterElement {
    overflow: hidden;
}

.cm-editor.blp-enhanced-list-handle {
    /* Keep handle UX as an enhancement of the original bullet dot (Logseq-like). */
    --blp-enhanced-list-handle-glow: hsla(var(--interactive-accent-hsl), 0.35);
    /* Spread is relative to font size so the halo scales with line-height. */
    --blp-enhanced-list-handle-glow-spread: 0.25em;
}

.cm-editor.blp-enhanced-list-handle .cm-formatting-list-ul,
.cm-editor.blp-enhanced-list-handle .cm-formatting-list-ol {
    cursor: grab;
}

.cm-editor.blp-enhanced-list-handle .cm-formatting-list-ul:active,
.cm-editor.blp-enhanced-list-handle .cm-formatting-list-ol:active {
    cursor: grabbing;
}

/* Glow the original bullet dot on hover/active (Logseq-like). */
.cm-editor.blp-enhanced-list-handle
  .cm-formatting-list-ul:hover
  .list-bullet::after,
.cm-editor.blp-enhanced-list-handle
  .cm-formatting-list-ol:hover
  .list-bullet::after,
.cm-editor.blp-enhanced-list-handle
  .cm-line.cm-active
  .cm-formatting-list-ul
  .list-bullet::after,
.cm-editor.blp-enhanced-list-handle
  .cm-line.cm-active
  .cm-formatting-list-ol
  .list-bullet::after {
    box-shadow: 0 0 0 var(--blp-enhanced-list-handle-glow-spread) var(--blp-enhanced-list-handle-glow);
}

/* Keep the bullet glow + affordance even when the caret is on a continuation line
 * of the same list item (e.g., fenced code, hidden system line). */
.cm-editor.blp-enhanced-list-handle
  .cm-line.blp-enhanced-list-active-bullet
  .cm-formatting-list-ul
  .list-bullet::after,
.cm-editor.blp-enhanced-list-handle
  .cm-line.blp-enhanced-list-active-bullet
  .cm-formatting-list-ol
  .list-bullet::after {
    box-shadow: 0 0 0 var(--blp-enhanced-list-handle-glow-spread) var(--blp-enhanced-list-handle-glow);
}

/* Highlight the whole active list block (Logseq-like). */
.cm-editor .cm-line.blp-enhanced-list-active-block {
    /* Use `background` (not background-color) to override theme active-line styling
     * (some themes add background-images that otherwise "stack" and look broken). */
    background: linear-gradient(
        to right,
        transparent var(--blp-enhanced-list-active-block-left, 0px),
        var(--background-modifier-hover) var(--blp-enhanced-list-active-block-left, 0px)
    );
}

/* When nested code blocks are shifted via margin-left, the active-block gradient
 * (which starts after the bullet dot) would "cut into" the code block background.
 * Use a solid active-block background for those lines (Logseq-like). */
.cm-editor .cm-line.blp-enhanced-list-active-block.blp-enhanced-list-codeblock-indented {
    background: var(--background-modifier-hover) !important;
}

/* Block selection mode (Enhanced List Blocks): highlight selected list item start lines. */
.cm-editor .cm-line.blp-enhanced-list-block-selected {
    /* Use `background` to override theme active-line styling. */
    background: hsla(var(--interactive-accent-hsl), 0.12);
    box-shadow: inset 2px 0 0 hsla(var(--interactive-accent-hsl), 0.9);
}

/* Nested fenced code blocks inside Enhanced List (UI-only).
 * Indentation is applied via CM decorations. Keep this class as a styling hook. */

/* Block Peek modal (Enhanced List Blocks). */
.blp-block-peek-header {
    margin-bottom: 0.75em;
}

.blp-block-peek-path {
    cursor: pointer;
    color: var(--text-accent);
    font-family: var(--font-monospace);
}

.blp-block-peek-section {
    margin-top: 0.75em;
}

.blp-block-peek-backlink {
    padding: 0.5em;
    border-radius: 6px;
    cursor: pointer;
}

.blp-block-peek-backlink:hover {
    background: var(--background-modifier-hover);
}

.blp-block-peek-backlink-path {
    font-weight: 600;
}

.blp-block-peek-backlink-line {
    margin-top: 0.25em;
    color: var(--text-muted);
    font-size: 0.9em;
}
